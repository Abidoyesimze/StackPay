# Sevalla deployment configuration for StackPay Backend
name: stackspay-backend
type: application
runtime: nodejs
version: 18

# Build configuration
build:
  command: pnpm install && pnpm build
  dockerfile: apps/backend/Dockerfile
  
# Start command
start: pnpm start

# Port configuration
port: 3001

# Health check
healthcheck:
  path: /health
  interval: 30s
  timeout: 10s
  retries: 3

# Environment variables
env:
  NODE_ENV: production
  PORT: 3001
  DATABASE_URL: ${DATABASE_URL}
  REDIS_URL: ${REDIS_URL}
  JWT_SECRET: ${JWT_SECRET}
  API_KEY_SECRET: ${API_KEY_SECRET}
  STACKS_NETWORK: ${STACKS_NETWORK}
  CORS_ORIGIN: ${CORS_ORIGIN}

# Scaling configuration
scaling:
  min_instances: 1
  max_instances: 10
  target_cpu: 70
  target_memory: 80

# Resource limits
resources:
  cpu: 1000m
  memory: 1Gi
  storage: 10Gi

# Networking
networking:
  internal: false
  allow_http: true
  allow_https: true

# Auto-deployment
deployment:
  branch: main
  auto_deploy: true
  preview_environments: true
